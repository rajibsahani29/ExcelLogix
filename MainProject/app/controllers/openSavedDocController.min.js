(function(){angular.module("iAspireApp").controller("OpenSavedDocController",["DataService","$scope","SMAAlertFactory","ProjectConstants",function(k,g,t,l){function v(){!1===g.AppC.IsTrialVersion&&k.GetSEAddinsVotesListForUser().success(function(a,c,d,h){u(a);for(var e in b.SurveyList)b.SurveyList[e].ShowSpinner=!1}).error(function(a,c,d,h){for(var e in b.SurveyList)b.SurveyList[e].ShowSpinner=!1})}function m(){k.getVoterListAsync().success(function(a,b,d,h){a.length&&0<a.length&&u(a);v()}).error(function(a,
b,d,h){0===b&&(2>n?(n+=1,m()):t.CreateInfoAlert("Alert","It seems iAspire is overloaded at the moment\n please try again later."))})}function u(a){for(var c in a){var d=!1,h;for(h in b.SurveyList)for(var e in b.SurveyList[h].VoteList)b.SurveyList[h].VoteList[e].VoterID===a[c].VoterID&&(d=!0);if(!1===d){a[c].IsInValidDateRange=!1;d=null;d=a[c].VoteDate?a[c].VoteDate:a[c].StartDate;a[c].StrFrmtLastEditDate=moment(d).format("ddd MMM Do YYYY hh:mm A");if(a[c].VoterAnswerFilterValues&&0<a[c].VoterAnswerFilterValues.length)for(var f in a[c].VoterAnswerFilterValues)"Date & Time"===
a[c].VoterAnswerFilterValues[f].VariableName&&(a[c].VoterAnswerFilterValues[f].VariableValue=moment(parseInt(a[c].VoterAnswerFilterValues[f].VariableValue)).format("ddd MMM Do YYYY HH:mm A"));for(var d=0,g=a[c].VoterAnswerFilterValues.length;d<g;d++)a[c][a[c].VoterAnswerFilterValues[d].VariableName.replace(" ","").replace("&","")]=a[c].VoterAnswerFilterValues[d].VariableValue;for(var k in b.SurveyList)b.SurveyList[k].SurveyID===a[c].SurveyID&&b.SurveyList[k].VoteList.push(a[c])}}}function p(a,c,d,
h){k.setVoterToOpen(c).success(function(a,f,y,z){b.activeVoterOpen=c;a="&"+l.QWRYSTR.ResumeID+"="+h;document.getElementById("surveyResumeIFrame").setAttribute("src",k.getAdminPanelSurveyURL(d,g.AppC.UserID,g.AppC.ActiveUser.SessionID)+a)}).error(function(a,b,c,d){403===b&&t.CreateInfoAlert("Alert","You may not edit this form.")})}function q(a){k.setVoterToClosed(b.activeVoterOpen).success(function(c,d,h,e){if(!0===a){for(var f in b.SurveyList)for(var g in b.SurveyList[f].VoteList)if(b.SurveyList[f].VoteList[g].VoterID===
b.activeVoterOpen){b.SurveyList[f].VoteList.splice(g,1);break}m()}}).error(function(a,b,h,e){})}function r(){var a=null,c;for(c in b.SurveyList)for(var d in b.SurveyList[c].VoteList){a=moment(b.SurveyList[c].VoteList[d].VoteDate);!1===a.isValid()&&(a=moment(b.SurveyList[c].VoteList[d].StartDate));for(var h in b.SurveyList[c].VoteList[d].VoterAnswerFilterValues)"Date & Time"===b.SurveyList[c].VoteList[d].VoterAnswerFilterValues[h].VariableName&&!0===moment(b.SurveyList[c].VoteList[d].VoterAnswerFilterValues[h].VariableValue,
"M/D/YYYY").isValid()&&(a=moment(b.SurveyList[c].VoteList[d].VoterAnswerFilterValues[h].VariableValue,"M/D/YYYY"));var e=null;b.FilterSettings.EarliestDateString&&(e=moment(b.FilterSettings.EarliestDateString,"YYYY-MM-DD"));var f=null;b.FilterSettings.LatestDateString&&(f=moment(b.FilterSettings.LatestDateString,"YYYY-MM-DD").endOf("day"));e&&!0===e.isValid()&&f&&!0===f.isValid()?!0===a.isBetween(e,f)?b.SurveyList[c].VoteList[d].IsInValidDateRange=!1:b.SurveyList[c].VoteList[d].IsInValidDateRange=
!0:e&&!0===e.isValid()?!0===a.isAfter(e)?b.SurveyList[c].VoteList[d].IsInValidDateRange=!1:b.SurveyList[c].VoteList[d].IsInValidDateRange=!0:f&&!0===f.isValid()&&(!0===a.isBefore(f)?b.SurveyList[c].VoteList[d].IsInValidDateRange=!1:b.SurveyList[c].VoteList[d].IsInValidDateRange=!0)}}g.AppC.ShowHeader=!0;g.AppC.ShowFooter=!0;g.AppC.ActivePageName="Forms";var b=this;b.dataLoaded=!1;b.SurveyList=[];b.BackButtonText="HOME";b.surveyIsLoaded=!1;b.resumeiFrameLoadedCallback=function(){function a(){"function"==
typeof d&&d();setTimeout(function(){if(c){var a=$(window).height()-50-40+"px";481<=window.innerWidth&&761>window.innerWidth?a=$(window).height()-55-45+"px":761<=window.innerWidth&&(a=$(window).height()-60-50+"px");c.style.minHeight=a;c.style.border="0";c.style.width="100%";c.style.display="block";c.style.position="relative";setTimeout(function(){-1<c.src.indexOf("surveymobilereport.aspx")?c.style.height=$(c).contents().find("#Panel").height()+"px":-1<c.src.indexOf("iAspireSurveyMobile.aspx")&&(c.style.height=
$(c).contents().find("body").height()+"px")},500)}},1)}var c=document.getElementById("surveyResumeIFrame");if(c.getAttribute("src")&&(-1<c.getAttribute("src").indexOf("iAspireSurveyMobile")||-1<c.getAttribute("src").indexOf("surveymobilereport"))){b.surveyIsLoaded=!0;b.BackButtonText="BACK";document.getElementsByClassName("iFrameWrapper");var d=window.resize;setTimeout(function(){a()},1);window.onhashchange=function(){window.onresize=null;window.onresize=d}}else b.BackButtonText="HOME";g.$apply()};
b.setVoterToOpen=p;b.loadPrintableSurvey=function(a,c,d,h){var e=!0,f;for(f in b.SurveyList)for(var g in b.SurveyList[f].VoteList)if(b.SurveyList[f].VoteList[g].VoterID===c&&!0===b.SurveyList[f].VoteList[g].Validated&&null!==b.SurveyList[f].VoteList[g].VoteDate){e=!1;break}!1===e?k.getViewVoteGuid(c).success(function(e,f,g,l){204===f?p(a,c,d,h):(document.getElementById("surveyResumeIFrame").setAttribute("src",k.getViewVoteURL(e)),b.activeVoterOpen=c)}).error(function(a,b,c,d){}):p(a,c,d,h)};b.ShowOverallSpinner=
null;b.FilterSettings=function(){};b.FilterSettings.EarliestDateString=null;b.FilterSettings.LatestDateString=null;b.FilterSettings.ReCalculateDateRange=r;b.FilterOptions={surveyID:-1,columnName:"",descending:!1};b.CustomFilter=function(a){var c=b.FilterOptions.columnName.toLowerCase();if("grade"===c){if(c=parseInt(a[b.FilterOptions.columnName]),!isNaN(c))return c}else if("lastsubmitted"===c)return a=a[b.FilterOptions.columnName].split("/").reverse(),a[3]=a[1],a[1]=a[2],a[2]=a[3],a[0]=Array(5-a[0].length).join("0")+
a[0],a[1]=Array(3-a[1].length).join("0")+a[1],a[2]=Array(3-a[2].length).join("0")+a[2],a.join("");return a[b.FilterOptions.columnName]};b.ChangeFilterSettings=function(a,c){b.FilterOptions.surveyID=c;b.FilterOptions.columnName===a.replace(" ","").replace("&","")?b.FilterOptions.descending=!b.FilterOptions.descending:(b.FilterOptions.columnName=a.replace(" ","").replace("&",""),b.FilterOptions.descending=!1);console.log(b.FilterOptions)};var w=g.$watch("oSD.FilterSettings.EarliestDateString",function(a,
b){r()}),x=g.$watch("oSD.FilterSettings.LatestDateString",function(a,b){r()});g.$on("$destroy",function(){$("#FromDate").datetimepicker("destroy");$("#ToDate").datetimepicker("destroy");w();x()});b.activeVoterOpen=0;b.backToSelectionPage=function(a){!0===b.surveyIsLoaded?(b.surveyIsLoaded=!1,a=document.getElementById("surveyResumeIFrame"),-1<a.getAttribute("src").indexOf("iAspireSurveyMobile")?q(!0):q(),a.setAttribute("src","")):window.location.hash="#/selection"};(function(){k.getSurveys().success(function(a,
c,d,g){b.ShowOverallSpinner=!1;for(var e in a)a[e].VoteList=[],a[e].ShowVotes=!0,a[e].ShowSpinner=!0;b.SurveyList=a;m()}).error(function(a,b,d,g){})})();window.document.getElementsByTagName("iframe")[0].addEventListener(l.Events.SurveyComplete,function(){var a=document.getElementById("surveyResumeIFrame");setTimeout(function(){b.surveyIsLoaded=!1;q(!0);a.setAttribute("src","")},3E3)});setTimeout(function(){!1!==b.ShowOverallSpinner&&(b.ShowOverallSpinner=!0);g.$apply()},l.Integers.LoadDelayTime);
var n=0;return b}])})();
