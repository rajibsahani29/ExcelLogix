(function(){angular.module("iAspireApp").directive("activefilter",function(){return{restrict:"A",scope:{passedFilter:"=filter",parentNeedNewDataObject:"=parentnddo",onRemove:"&"},replace:!0,templateUrl:"app/views/activeFilterView.html",controller:"ActiveFilterController",controllerAs:"activeFilter"}}).factory("ActiveFilterLogic",function(){function c(c,b,k,d){var g;1===d?g=!1:-1===d&&(g=!0);var f=Object.keys(c),m;for(m in f)if(-1<f[m].indexOf("_"+b)){b=!1;for(var l in k)c[f[m]]===k[l].SelectedOption&&
(b=!0);1===d&&!0===b?g=!0:-1===d&&!0===b&&(g=!1);break}return g}this.ApplyFiltersToVotes=function(h,b){var k=[],d,g=[];0<b.filter(function(a){return 1===a.FilterType&&"iaspireuserid"===a.ValueVariableName?!0:!1}).length?d=1:0<b.filter(function(a){return-1===a.FilterType&&"iaspireuserid"===a.ValueVariableName?!0:!1}).length&&(d=-1);d&&(g=b.filter(function(a){return a.FilterType===d&&"iaspireuserid"===a.ValueVariableName?!0:!1}));var f,m=[];0<b.filter(function(a){return 1===a.FilterType&&"districtid"===
a.ValueVariableName?!0:!1}).length?f=1:0<b.filter(function(a){return-1===a.FilterType&&"districtid"===a.ValueVariableName?!0:!1}).length&&(f=-1);f&&(m=b.filter(function(a){return a.FilterType===f&&"districtid"===a.ValueVariableName?!0:!1}));var l,t=[];0<b.filter(function(a){return 1===a.FilterType&&"schoolid"===a.ValueVariableName?!0:!1}).length?l=1:0<b.filter(function(a){return-1===a.FilterType&&"schoolid"===a.ValueVariableName?!0:!1}).length&&(l=-1);l&&(t=b.filter(function(a){return a.FilterType===
l&&"schoolid"===a.ValueVariableName?!0:!1}));var n,u=[];0<b.filter(function(a){return 1===a.FilterType&&"teacherid"===a.ValueVariableName?!0:!1}).length?n=1:0<b.filter(function(a){return-1===a.FilterType&&"teacherid"===a.ValueVariableName?!0:!1}).length&&(n=-1);n&&(u=b.filter(function(a){return a.FilterType===n&&"teacherid"===a.ValueVariableName?!0:!1}));var p,v=[];0<b.filter(function(a){return 1===a.FilterType&&!0===("classid"===a.ValueVariableName||"subjectid"===a.ValueVariableName)?!0:!1}).length?
p=1:0<b.filter(function(a){return-1===a.FilterType&&!0===("classid"===a.ValueVariableName||"subjectid"===a.ValueVariableName)?!0:!1}).length&&(p=-1);p&&(v=b.filter(function(a){return a.FilterType===p&&!0===("classid"===a.ValueVariableName||"subjectid"===a.ValueVariableName)?!0:!1}));var q,w=[];0<b.filter(function(a){return 1===a.FilterType&&"gradeid"===a.ValueVariableName?!0:!1}).length?q=1:0<b.filter(function(a){return-1===a.FilterType&&"gradeid"===a.ValueVariableName?!0:!1}).length&&(q=-1);q&&(w=
b.filter(function(a){return a.FilterType===q&&"gradeid"===a.ValueVariableName?!0:!1}));for(var r in h){var e=!0;!0===e&&!0===(-1===d||1===d)&&0<g.length&&(e=c(h[r],g[0].AnswerID,g,d));!0===e&&!0===(-1===f||1===f)&&0<m.length&&(e=c(h[r],m[0].AnswerID,m,f));!0===e&&!0===(-1===l||1===l)&&0<t.length&&(e=c(h[r],t[0].AnswerID,t,l));!0===e&&!0===(-1===n||1===n)&&0<u.length&&(e=c(h[r],u[0].AnswerID,u,n));!0===e&&!0===(-1===p||1===p)&&0<v.length&&(e=c(h[r],v[0].AnswerID,v,p));!0===e&&!0===(-1===q||1===q)&&
0<w.length&&(e=c(h[r],w[0].AnswerID,w,q));!0===e&&k.push(h[r].VoterID)}return k};this.SurvivesFilter=c;return this}).controller("ActiveFilterController",["$scope","ActiveFilterLogic",function(c,h){var b=this;b.PSSQ=c.passedFilter;b.FilterTypePlaceholder=null;b.PSSQ.FilterType=null;b.PSSQ.SelectedOption=null;c.$watch("activeFilter.FilterTypePlaceholder",function(k,d){k&&k!==d&&(b.PSSQ.FilterType=JSON.parse(k),c.parentNeedNewDataObject.NeedNewData=!0)});c.$watch("activeFilter.PSSQ.SelectedOption",function(b,
d){b&&b!==d&&(c.parentNeedNewDataObject.NeedNewData=!0)});setTimeout(function(){b.FilterTypePlaceholder="1";c.$apply()},1);return b}])})();
