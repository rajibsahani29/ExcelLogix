(function(){angular.module("iAspireApp").directive("reportingquestion",function(){return{restrict:"E",scope:{passedQuestion:"=question"},replace:!0,templateUrl:"app/views/reportingQuestionView.html",controller:"ReportingQuestionController",controllerAs:"rQC"}}).factory("ReportingQuestionConstants",function(){this.GetBaseGoogleChartsObject=function(t,x,m,z){return{type:t||"ColumnChart",data:x||{cols:[],rows:[]},options:m||{},formatters:z||{}}};this.DataFormatEnum={Totals:0,History:1,TotalsPercent:2,
HistoryPercent:3};this.TimeIntervalEnum={Day:0,Week:1,Month:3,Quarter:5,Year:7};this.ChartTypeEnum={PieChart:0,ColumnChart:1,LineChart:2,Table:3};return this}).factory("ReportingQuestionLogic",["ReportingQuestionConstants","ReportsControllerLogic","ReportsConstants",function(t,x,m){function z(q,a,l){var f=(q[1].v/m.FilteredVotesCount*100).toFixed(1),d=(q[1].v/a*100).toFixed(1),c=(q[1].v/l*100).toFixed(1);return{v:'<div class="googleChartsToolTip"><div><label style="font-weight: bold;">'+q[0].v+"</label></div><div><label>Frequency: "+
q[1].v.toString()+"</label></div><div><label>"+f+"% of total submissions ("+m.FilteredVotesCount+")</label></div><div><label>"+d+"% of submitted answers ("+a+")</label></div><div><label>"+c+"% rate of response by question response rate ("+l+")</label></div></div>",p:{}}}function F(q,a,l,f,d){var c=(q/m.FilteredVotesCount*100).toFixed(1),h=(q/f*100).toFixed(1),n=(q/d*100).toFixed(1),u=document.createElement("div"),b=document.createElement("div"),g=document.createElement("div"),y=document.createElement("div"),
k=document.createElement("div"),B=document.createElement("div"),C=document.createElement("div");u.classList.add("googleChartsToolTip");u.appendChild(b);u.appendChild(g);u.appendChild(y);u.appendChild(k);u.appendChild(B);u.appendChild(C);var I=document.createElement("label");I.innerText=a;I.classList.add("toolTipBold");b.appendChild(I);a=document.createElement("label");a.innerText=l;a.classList.add("toolTipBold");g.appendChild(a);l=document.createElement("label");l.innerText="Frequency: "+q;y.appendChild(l);
q=document.createElement("label");q.innerText=c+"% of total submissions ("+m.FilteredVotesCount+")";k.appendChild(q);c=document.createElement("label");c.innerText=h+"% of submitted answers for time frame ("+f+")";B.appendChild(c);f=document.createElement("label");f.innerText=n+"% rate of response by question response rate for time frame ("+d+")";C.appendChild(f);d=document.createElement("div");d.appendChild(u);return{v:d.innerHTML,p:{}}}function D(q,a,l){return{v:'<div class="googleChartsToolTip"><div><label style="font-weight: bold;">'+
q+"</label></div><div><label>"+l+"% of total submissions ("+m.FilteredVotesCount+")</label></div><div><label>Frequency: "+a+"</label></div></div>",p:{}}}function v(q,a,l,f){var d=document.createElement("div"),c=document.createElement("div"),h=document.createElement("div"),n=document.createElement("div");d.classList.add("googleChartsToolTip");d.appendChild(c);d.appendChild(h);d.appendChild(n);var u=document.createElement("label");u.innerText=a;u.classList.add("toolTipBold");c.appendChild(u);a=document.createElement("label");
a.innerText=l;a.classList.add("toolTipBold");h.appendChild(a);l=document.createElement("label");l.innerText=q+"% of "+f;n.appendChild(l);q=document.createElement("div");q.appendChild(d);return{v:q.innerHTML,p:{}}}function r(q,a,l){l=t.DataFormatEnum[l];var f={CommentList:[],GoogleChartsObjectList:[]},d={tooltip:{isHtml:!0},title:q.CleanQuestionText},c=[];c.push({id:"a",label:"Answers",type:"string"});c.push({id:"f",label:"Frequency",type:"number"});c.push({id:"",role:"tooltip",type:"string",p:{role:"tooltip",
html:!0}});var h=t.GetBaseGoogleChartsObject(a,null,d,null);a=t.GetBaseGoogleChartsObject(a,null,d,null);for(d=0;d<c.length;d++)h.data.cols.push(c[d]),a.data.cols.push(c[d]);var n=q.Answers.filter(function(b){return J(b)}),u=q.Answers.filter(function(b){return K(b)}),c=q.Answers.filter(function(b){return L(b)});q.Answers.filter(function(b){return!1});d=q.Answers.filter(function(b){return M(b)});q=q.Answers.filter(function(b){return N(b)});if(0<n.length){var n=p(n,l),b;for(b in n)h.data.rows.push(n[b])}if(0<
u.length){b=E(u,l);for(var g in b)h.data.rows.push(b[g])}if(0<q.length){g=e(q,l);for(var y in g)h.data.rows.push(g[y])}0<c.length&&(a.data.rows=A(c,l));0<d.length&&(f.CommentList=O(d));f.GoogleChartsObjectList=[h,a];return f}function w(q,a,l,f){var d=t.DataFormatEnum[l];l={CommentList:[],GoogleChartsObjectList:[]};var c={title:q.CleanQuestionText,tooltip:{isHtml:!0}},h=[],n=[],u=0,b=0,g=0,y="",k="";switch(t.TimeIntervalEnum[f]){case 0:u=m.StartDate.dayOfYear();b=m.EndDate.dayOfYear();g=365;y="dayOfYear";
k="DDDo [day of the year]";h.push({id:"dayOfTheYear",label:"Day",type:"string"});break;case 1:u=m.StartDate.week();b=m.EndDate.week();g=52;y="week";k="wo [week of the year]";h.push({id:"weekOfTheYear",label:"Week",type:"string"});break;case 3:u=m.StartDate.month();b=m.EndDate.month();g=12;y="month";k="MMMM";h.push({id:"month",label:"Month",type:"string"});break;case 5:u=m.StartDate.quarter();b=m.EndDate.quarter();g=4;y="quarter";k="[Quarter:] Q";h.push({id:"quarter",label:"Quarter",type:"string"});
break;case 7:u=m.StartDate.year(),b=m.EndDate.year(),g=1,y="year",k="YYYY",h.push({id:"year",label:"Year",type:"string"})}f=m.EndDate.year()-m.StartDate.year();0<f&&(b+=g*f);for(f=u;f<=b;f++)n.push({c:[{id:f,v:moment(m.StartDate.year(),"YYYY")[y](f).format(k)}]});b=t.GetBaseGoogleChartsObject(a,null,c,null);a=t.GetBaseGoogleChartsObject(a,null,c,null);for(c=0;c<h.length;c++)b.data.cols.push(h[c]),a.data.cols.push(h[c]);for(h=0;h<n.length;h++)b.data.rows.push(n[h]),a.data.rows.push(n[h]);f=q.Answers.filter(function(b){return J(b)});
k=q.Answers.filter(function(b){return K(b)});n=q.Answers.filter(function(b){return L(b)});q.Answers.filter(function(b){return!1});h=q.Answers.filter(function(b){return M(b)});c=q.Answers.filter(function(b){return N(b)});if(0<f.length){f=p(f,d,y,g);for(u=0;u<f.NewColumns.length;u++)b.data.cols.push(f.NewColumns[u]);for(u=0;u<f.DataLists.length;u++)for(var B=0,C=b.data.rows.length;B<C;B++){var I=b.data.rows[B].c[0].id;f.DataLists[u][I]?b.data.rows[B].c.push({v:f.DataLists[u][I]}):b.data.rows[B].c.push({v:"0.0"})}}if(0<
k.length){k=E(k,d,y,g);for(f=0;f<k.NewColumns.length;f++)b.data.cols.push(k.NewColumns[f]);for(f=0;f<k.DataLists.length;f++)for(u=0,B=b.data.rows.length;u<B;u++)C=b.data.rows[u].c[0].id,k.DataLists[f][C]?b.data.rows[u].c.push({v:k.DataLists[f][C]}):b.data.rows[u].c.push({v:"0.0"})}if(0<c.length){g=e(c,d,y,g);for(c=0;c<g.NewColumns.length;c++)b.data.cols.push(g.NewColumns[c]);for(c=0;c<g.DataLists.length;c++)for(k=0,f=b.data.rows.length;k<f;k++)u=b.data.rows[k].c[0].id,g.DataLists[c][u]?b.data.rows[k].c.push({v:g.DataLists[c][u]}):
b.data.rows[k].c.push({v:"0.0"})}a.data.rows=0<n.length?A(n,d):[];0<h.length&&(l.CommentList=O(h));for(d=1;d<b.data.cols.length;d+=2)for(b.data.cols.splice(d+1,0,{id:b.data.cols[d].id+"-toolTip",role:"tooltip",type:"string",p:{role:"tooltip",html:!0}}),g=0;g<b.data.rows.length;g++){n=0;for(h=1;h<b.data.rows[g].c.length;)b.data.rows[g].c[h]&&"0.0"!==b.data.rows[g].c[h].v&&(n+=b.data.rows[g].c[h].v),h<d?h+=2:h++;b.data.rows[g].c[d]&&(h=x.GetVoterCountByDateRangeIfQuestionWasAnswered(y,b.data.rows[g].c[0].id,
q.OldQuestionID),b.data.rows[g].c.splice(d+1,0,F(b.data.rows[g].c[d].v,b.data.rows[g].c[0].v,b.data.cols[d].label,n,h)))}l.GoogleChartsObjectList=[b,a];return l}function H(q,a,l){l=t.DataFormatEnum[l];var f={CommentList:[],GoogleChartsObjectList:[]},d={tooltip:{isHtml:!0},title:q.CleanQuestionText},c=[];c.push({id:"a",label:"Answers",type:"string"});c.push({id:"f",label:"Percent Of Total Submissions",type:"number"});c.push({id:"",role:"tooltip",type:"string",p:{role:"tooltip",html:!0}});var h=t.GetBaseGoogleChartsObject(a,
null,d,null);a=t.GetBaseGoogleChartsObject(a,null,d,null);for(d=0;d<c.length;d++)h.data.cols.push(c[d]),a.data.cols.push(c[d]);var n=q.Answers.filter(function(b){return J(b)}),u=q.Answers.filter(function(b){return K(b)}),c=q.Answers.filter(function(b){return L(b)});q.Answers.filter(function(b){return!1});d=q.Answers.filter(function(b){return M(b)});q=q.Answers.filter(function(b){return N(b)});if(0<n.length){var n=p(n,l),b;for(b in n)h.data.rows.push(n[b])}if(0<u.length){b=E(u,l);for(var g in b)h.data.rows.push(b[g])}if(0<
q.length){g=e(q,l);for(var y in g)h.data.rows.push(g[y])}0<c.length&&(a.data.rows=A(c,l));0<d.length&&(f.CommentList=O(d));f.GoogleChartsObjectList=[h,a];return f}function a(q,a,l,f){var d=t.DataFormatEnum[l];l={CommentList:[],GoogleChartsObjectList:[]};var c={title:q.CleanQuestionText,tooltip:{isHtml:!0}},h=[],n=[],u=0,b=0,g=0,y="",k="";switch(t.TimeIntervalEnum[f]){case 0:u=m.StartDate.dayOfYear();b=m.EndDate.dayOfYear();g=365;y="dayOfYear";k="DDDo [day of the year]";h.push({id:"dayOfTheYear",label:"Day",
type:"string"});break;case 1:u=m.StartDate.week();b=m.EndDate.week();g=52;y="week";k="wo [week of the year]";h.push({id:"weekOfTheYear",label:"Week",type:"string"});break;case 3:u=m.StartDate.month();b=m.EndDate.month();g=12;y="month";k="MMMM";h.push({id:"month",label:"Month",type:"string"});break;case 5:u=m.StartDate.quarter();b=m.EndDate.quarter();g=4;y="quarter";k="[Quarter:] Q";h.push({id:"quarter",label:"Quarter",type:"string"});break;case 7:u=m.StartDate.year(),b=m.EndDate.year(),g=1,y="year",
k="YYYY",h.push({id:"year",label:"Year",type:"string"})}f=m.EndDate.year()-m.StartDate.year();0<f&&(b+=g*f);for(f=u;f<=b;f++)n.push({c:[{id:f,v:moment(m.StartDate.year(),"YYYY")[y](f).format(k)}]});b=t.GetBaseGoogleChartsObject(a,null,c,null);a=t.GetBaseGoogleChartsObject(a,null,c,null);for(c=0;c<h.length;c++)b.data.cols.push(angular.copy(h[c])),a.data.cols.push(angular.copy(h[c]));for(h=0;h<n.length;h++)b.data.rows.push(angular.copy(n[h])),a.data.rows.push(angular.copy(n[h]));k=q.Answers.filter(function(b){return J(b)});
c=q.Answers.filter(function(b){return K(b)});n=q.Answers.filter(function(b){return L(b)});q.Answers.filter(function(b){return!1});h=q.Answers.filter(function(b){return M(b)});q=q.Answers.filter(function(b){return N(b)});if(0<k.length){g=p(k,d,y,g);for(k=0;k<g.NewColumns.length;k++)b.data.cols.push(g.NewColumns[k]);for(k=0;k<g.DataLists.length;k++)for(f=0,u=b.data.rows.length;f<u;f++){var B=b.data.rows[f].c[0].id;if(g.DataLists[k][B]){var C=x.GetVoterCountByDateRange(y,B),B={v:(g.DataLists[k][B]/C*
100).toFixed(1)};b.data.rows[f].c.push(B)}else b.data.rows[f].c.push({v:"0.0"})}}if(0<c.length){g=E(c,d,y);for(c=0;c<g.NewColumns.length;c++)b.data.cols.push(g.NewColumns[c]);for(c=0;c<g.DataLists.length;c++)for(k=0,f=b.data.rows.length;k<f;k++)u=b.data.rows[k].c[0].id,g.DataLists[c][u]?(B=x.GetVoterCountByDateRange(y,u),u={v:(g.DataLists[c][u]/B*100).toFixed(1)},b.data.rows[k].c.push(u)):b.data.rows[k].c.push({v:"0.0"})}if(0<q.length){q=e(q,d,y);for(g=0;g<q.NewColumns.length;g++)b.data.cols.push(q.NewColumns[g]);
for(g=0;g<q.DataLists.length;g++)for(c=0,k=b.data.rows.length;c<k;c++)f=b.data.rows[c].c[0].id,q.DataLists[g][f]?(u=x.GetVoterCountByDateRange(y,f),f={v:(q.DataLists[g][f]/u*100).toFixed(1)},b.data.rows[c].c.push(f)):b.data.rows[c].c.push({v:"0.0"})}a.data.rows=0<n.length?A(n,d):[];0<h.length&&(l.CommentList=O(h));for(d=1;d<b.data.cols.length;d+=2)for(b.data.cols.splice(d+1,0,{id:b.data.cols[d].id+"-toolTip",role:"tooltip",type:"string",p:{role:"tooltip",html:!0}}),n=0;n<b.data.rows.length;n++)h=
x.GetVoterCountByDateRange(y,b.data.rows[n].c[0].id),b.data.rows[n].c[d]&&b.data.rows[n].c.splice(d+1,0,v(b.data.rows[n].c[d].v,b.data.rows[n].c[0].v,b.data.cols[d].label,h));l.GoogleChartsObjectList=[b,a];return l}function p(q,a,l,f){function d(){var a=[],b=0,g=[],f;for(f in q){var k=x.GetVoterAnswerValuesByAnswerID(q[f].OldAnswerID),c=0,d;for(d in k)if("true"===k[d].VoterAnswerValue||"1"===k[d].VoterAnswerValue)c++,b++,-1===g.indexOf(k[d].VoterID)&&g.push(k[d].VoterID);a.push({c:[{v:q[f].CleanAnswerText},
{v:c}]})}var g=g.length,h;for(h in a)a[h].c.push(z(a[h].c,b,g));return a}function c(){var a=[],b=[],g=0,c;for(c in q){var k={},d=x.GetVoterAnswerValuesByAnswerID(q[c].OldAnswerID),h;for(h in d){var n=null,e="";-1!==d[h].DateFromForm?(n=d[h].DateFromForm,e="MM-DD-YYYY"):(n=d[h].StartDate,e="YYYY-MM-DDTHH:mm:ss");n=moment(n,e);e=0;"year"!==l?!0===m.StartDate.isSame(n,"year")?e=n[l]():(e=(n.year()-m.StartDate.year())*f,e=n[l]()+e):e=n[l]();k[e]?k[e]++:k[e]=1;g++}a.push({id:q[c].OldAnswerID,label:q[c].CleanAnswerText,
type:"number"});b.push(k)}return{NewColumns:a,DataLists:b,TotalFrequency:g}}function h(){var a=[],b;for(b in q){var g=x.GetVoterAnswerValuesByAnswerID(q[b].OldAnswerID),c=0,k;for(k in g)"true"!==g[k].VoterAnswerValue&&"1"!==g[k].VoterAnswerValue||c++;g=(c/m.FilteredVotesCount*100).toFixed(1);a.push({c:[{v:q[b].CleanAnswerText},{v:g},D(q[b].CleanAnswerText,c,g)]})}return a}function n(){var a=[],b=[],g;for(g in q){var c={},k=x.GetVoterAnswerValuesByAnswerID(q[g].OldAnswerID),d;for(d in k){var h=null,
n="";-1!==k[d].DateFromForm?(h=k[d].DateFromForm,n="MM-DD-YYYY"):(h=k[d].StartDate,n="YYYY-MM-DDTHH:mm:ss");h=moment(h,n);n=0;"year"!==l?!0===m.StartDate.isSame(h,"year")?n=h[l]():(n=(h.year()-m.StartDate.year())*f,n=h[l]()+n):n=h[l]();c[n]?c[n]++:c[n]=1}b.push({id:q[g].OldAnswerID,label:q[g].CleanAnswerText,type:"number"});a.push(c)}return{NewColumns:b,DataLists:a}}return 0===a?d():1===a?c():2===a?h():3===a?n():{}}function E(a,e,l,f){function d(){var c=[],d=0,b=[],g;for(g in a){var f=[],k=x.GetVoterAnswerValuesByAnswerID(a[g].OldAnswerID),
h;for(h in k){var e=k[h].VoterAnswerValue;if(e&&""!==e){var l=!1,m;for(m in f)if(f[m].TextValue===e){l=!0;f[m].Count++;d++;-1===b.indexOf(k[h].VoterID)&&b.push(k[h].VoterID);break}!1===l&&(f.push({TextValue:e,Count:1}),d++,-1===b.indexOf(k[h].VoterID)&&b.push(k[h].VoterID))}}for(var A in f)c.push({c:[{v:f[A].TextValue},{v:f[A].Count}]})}var b=b.length,p;for(p in c)c[p].c.push(z(c[p].c,d,b));return c}function c(){var c=0,d=[],b=[],g;for(g in a){var h=[],k=x.GetVoterAnswerValuesByAnswerID(a[g].OldAnswerID),
e;for(e in k){var C=k[e].VoterAnswerValue;if(C&&""!==C){var A=!1,p=null,G="";-1!==k[e].DateFromForm?(p=k[e].DateFromForm,G="MM-DD-YYYY"):(p=k[e].StartDate,G="YYYY-MM-DDTHH:mm:ss");p=moment(p,G);G=0;"year"!==l?!0===m.StartDate.isSame(p,"year")?G=p[l]():(G=(p.year()-m.StartDate.year())*f,G=p[l]()+G):G=p[l]();for(var v in h)if(h[v].TextValue===C){A=!0;h[v].DataList[G]++;c++;break}!1===A&&(C={TextValue:C,DataList:{}},C.DataList[G]=1,c++,h.push(C))}}for(var r in h)d.push({id:h[r].TextValue.toLowerCase(),
label:h[r].TextValue,type:"number"}),b.push(h[r].DataList)}return{NewColumns:d,DataLists:b,TotalFrequency:c}}function h(){var c=[],d;for(d in a){var b=[],g=x.GetVoterAnswerValuesByAnswerID(a[d].OldAnswerID),h;for(h in g){var k=g[h].VoterAnswerValue;if(k&&""!==k){var f=!1,e;for(e in b)if(b[e].TextValue===k){f=!0;b[e].Count++;break}!1===f&&b.push({TextValue:k,Count:1})}}for(var l in b)g=(b[l].Count/m.FilteredVotesCount*100).toFixed(1),c.push({c:[{v:b[l].TextValue},{v:g},D(b[l].TextValue,b[l].Count,
g)]})}return c}return 0===e?d():1===e?c():2===e?h():3===e?[]:{}}function e(a,e,l,f){function d(){var c=[],b=0,g=[],d;for(d in a){var k=[],h=x.GetVoterAnswerValuesByAnswerID(a[d].OldAnswerID),f;for(f in h){var e=h[f].VoterAnswerValue;if(e&&""!==e){var l=!1,n;for(n in k)if(k[n].TextValue===e){l=!0;k[n].Count++;b++;-1===g.indexOf(h[f].VoterID)&&g.push(h[f].VoterID);break}!1===l&&(k.push({TextValue:e,Count:1}),b++,-1===g.indexOf(h[f].VoterID)&&g.push(h[f].VoterID))}}for(var m in k)c.push({c:[{v:k[m].TextValue},
{v:k[m].Count}]})}var g=g.length,p;for(p in c)c[p].c.push(z(c[p].c,b,g));return c}function c(){var c=0,b=[],g=[],h;for(h in a){var d=[],e=x.GetVoterAnswerValuesByAnswerID(a[h].OldAnswerID),n;for(n in e){var p=e[n].VoterAnswerValue;if(p&&""!==p){var A=!1,r=null,v="";-1!==e[n].DateFromForm?(r=e[n].DateFromForm,v="MM-DD-YYYY"):(r=e[n].StartDate,v="YYYY-MM-DDTHH:mm:ss");r=moment(r,v);v=0;!0===m.StartDate.isSame(r,"year")?v=r[l]():(v=(r.year()-m.StartDate.year())*f,v=r[l]()+v);for(var E in d)if(d[E].TextValue===
p){A=!0;d[E].DataList[v]++;c++;break}!1===A&&(p={TextValue:p,DataList:{}},p.DataList[v]=1,c++,d.push(p))}}for(var w in d)b.push({id:d[w].TextValue.toLowerCase(),label:d[w].TextValue,type:"number"}),g.push(d[w].DataList)}return{NewColumns:b,DataLists:g,TotalFrequency:c}}function h(){var c=[],b;for(b in a){var g=[],d=x.GetVoterAnswerValuesByAnswerID(a[b].OldAnswerID),h;for(h in d){var f=d[h].VoterAnswerValue;if(f&&""!==f){var e=!1,n;for(n in g)if(g[n].TextValue===f){e=!0;g[n].Count++;break}!1===e&&
g.push({TextValue:f,Count:1})}}for(var l in g)d=(g[l].Count/m.FilteredVotesCount*100).toFixed(1),c.push({c:[{v:g[l].TextValue},{v:d},D(g[l].TextValue,g[l].Count,d)]})}return c}function n(){var c=0,b=[],g=[],d;for(d in a){var h=[],e=x.GetVoterAnswerValuesByAnswerID(a[d].OldAnswerID),n;for(n in e){var p=e[n].VoterAnswerValue;if(p&&""!==p){var A=!1,v=null,r="";-1!==e[n].DateFromForm?(v=e[n].DateFromForm,r="MM-DD-YYYY"):(v=e[n].StartDate,r="YYYY-MM-DDTHH:mm:ss");v=moment(v,r);r=0;!0===m.StartDate.isSame(v,
"year")?r=v[l]():(r=(v.year()-m.StartDate.year())*f,r=v[l]()+r);for(var E in h)if(h[E].TextValue===p){A=!0;h[E].DataList[r]++;c++;break}!1===A&&(p={TextValue:p,DataList:{}},p.DataList[r]=1,c++,h.push(p))}}for(var w in h)b.push({id:h[w].TextValue.toLowerCase(),label:h[w].TextValue,type:"number"}),g.push(h[w].DataList)}return{NewColumns:b,DataLists:g,TotalFrequency:c}}return 0===e?d():1===e?c():2===e?h():3===e?n():{}}function A(a,e,l,f){function d(){var c=[],d=0,f;for(f in a){var b={};0===a[f].SliderStep&&
(a[f].SliderStep=1);for(var g=a[f].SliderMin;g<=a[f].SliderMax;g+=a[f].SliderStep)b[g]=0;var g=x.GetVoterAnswerValuesByAnswerID(a[f].OldAnswerID),e;for(e in g)b[g[e].VoterAnswerValue]++,d++;var g=Object.keys(b),k;for(k in g)c.push({c:[{v:g[k]},{v:b[g[k]]}]})}for(var l in c)c[l].c.push(z(c[l].c,d));return c}function c(){var c=[],d;for(d in a){var f={};0===a[d].SliderStep&&(a[d].SliderStep=1);for(var b=a[d].SliderMin;b<=a[d].SliderMax;b+=a[d].SliderStep)f[b]=0;var b=x.GetVoterAnswerValuesByAnswerID(a[d].OldAnswerID),
g;for(g in b)f[b[g].VoterAnswerValue]++;var b=Object.keys(f),e;for(e in b){var k=(f[b[e]]/m.FilteredVotesCount*100).toFixed(1);c.push({c:[{v:b[e]},{v:k},D(b[e].toString(),f[b[e]],k)]})}}return c}return 0===e?d():1===e?null:2===e?c():3===e?null:{}}function O(a){var e=[],l;for(l in a){var f=x.GetVoterAnswerValuesByAnswerID(a[l].OldAnswerID),d;for(d in f){var c=null,c=-1!==f[d].DateFromForm?f[d].DateFromForm:f[d].StartDate,c=moment(c,"MM-DD-YYYY").utcOffset(moment().utcOffset()),c={VoterStartDate:c.isValid()?
c.format("D MMM, YYYY"):"",CommentText:f[d].VoterAnswerValue};e.push(c)}}return e}function J(a){return 1===a.AnswerTypeID?!0:!1}function K(a){return 2===a.AnswerTypeID?!0:!1}function L(a){return 56===a.AnswerTypeID?!0:!1}function M(a){return 24===a.AnswerTypeID?!0:!1}function N(a){return 3===a.AnswerTypeID||103===a.AnswerTypeID?!0:!1}this.ConvertGCDataToCSV=function(a){for(var e=a.data.cols.length,l=a.data.rows.length,f=[],d=0;d<e;d++)f.push(a.data.cols[d].label.replace(/,/g,""));f=f.join(",")+"\r\n";
for(d=0;d<l;d++){for(var c=[],h=0;h<e;h++)a.data.rows[d].c[h].v.replace?c.push(a.data.rows[d].c[h].v.replace(/,/g,"")):c.push(a.data.rows[d].c[h].v);f+=c.join(",")+"\r\n"}return f};this.DisplayComments=function(a){return 1===a?!0:!1};this.FormatDataForCorrectReportType=function(e,p,l,f){var d=null,c=t.DataFormatEnum[l];0===c?d=r(e,p,l):1===c?d=w(e,p,l,f):2===c?d=H(e,p,l):3===c&&(d=a(e,p,l,f));return d};this.GetDataRows_Boolean=p;this.GetDataRows_BooleanOther=E;this.GetDataRows_TextEntry=e;this.GetDataRows_RangeAnswers=
A;this.GetDataRows_Comments=O;this.CheckAnswerType_IsBooleanAnswerType=J;this.CheckAnswerType_IsOtherAnswerType=K;this.CheckAnswerType_IsRangeAnswerType=L;this.CheckAnswerType_IsHiddenAnswerType=function(a){return 27===a.AnswerTypeID||101===a.AnswerTypeID?!0:!1};this.CheckAnswerType_IsDropDownAnswerType=function(a){return!1};this.CheckAnswerType_IsCommentAnswerType=M;this.CheckAnswerType_IsTextboxAnswerType=N;this.CheckAnswerType_IsCalendarAnswerType=function(a){return 22===a.AnswerTypeID?!0:!1};
this.CheckAnswerType_IsFileUploadAnswerType=function(a){return 30===a.AnswerTypeID?!0:!1};this.GetAbstractTimeValue=function(a,e){var l=moment(e),f=null;switch(a){case 0:f=l.dayOfYear();break;case 1:f=l.week();break;case 3:f=l.month();break;case 5:f=l.quarter();break;case 7:f=l.year()}return f};return this}]).factory("ReportingQuestionInterface",["$q","ReportsConstants",function(t,x){function m(m){for(var r=[],w=[],t=0,a=m.children[0].children[0].children.length;t<a;t++)r.push(m.children[0].children[0].children[t].textContent);
t=0;for(a=m.children[1].children.length;t<a;t++){for(var p=m.children[1].children[t],E=[],e=0,A=p.children.length;e<A;e++)E.push(p.children[e].textContent);w.push(E)}return{columns:r,rows:w}}var z={},F=[],D=[];z.RegisterImage=function(m,r,w){var t=-1;m={displayOrder:m,questionID:r,base64:w};0<F.filter(function(a,m){return a.questionID===r?(t=m,!0):!1}).length?F.splice(t,1,m):F.push(m);F.sort(function(a,m){return a.displayOrder==m.displayOrder})};z.RegisterCommentOnlyQuestion=function(v){var r=document.getElementById("comments-"+
v),r=m(r.children[0]);if(0<r.rows.length){var t=D.map(function(m){return m.questionID}).indexOf(v);-1<t?D.splice(t,1,{questionID:v,table:r}):D.push({questionID:v,table:r})}};z.RenderSingleReport=function(v){var r=0,w=0,z=t.defer(),a=new Image;a.onload=function(){r=.75*this.height;w=.75*this.width;if(582<w){var a=582/w;r*=a;w*=a}z.resolve()};a.src=F[0].base64;z.promise.then(function(){a=null;var p=new jsPDF("p","pt","letter");p.setFontSize(8);var t=10;a=F.filter(function(a){return a.questionID==v?
!0:!1});0<a.length&&(p.addImage(a[0].base64,0,10,w,r),t+=r);var e=m(document.getElementById("comments-"+v).children[0]);0<e.rows.length&&p.autoTable(e.columns,e.rows,{startY:t+20,styles:{fontSize:10,overflow:"linebreak"}});p.save((x.SurveyTitle||"singleReport")+".pdf")})};z.RenderReport=function(){var v=t.defer(),r=0,w=0,z=t.defer(),a=new Image;a.onload=function(){r=.75*this.height;w=.75*this.width;if(582<w){var a=582/w;r*=a;w*=a}z.resolve()};a.src=F[0].base64;z.promise.then(function(){a=null;var p=
new jsPDF("p","pt","letter");p.setFontSize(8);var t=m(document.getElementById("VoteListWrapper").children[0]);p.autoTable(t.columns,t.rows,{styles:{fontSize:10,overflow:"linebreak"}});for(var e=t=null,A=0,v=F.length;A<v;A++)p.addPage(),p.addImage(F[A].base64,0,10,w,r),e=document.getElementById("comments-"+F[A].questionID),null!==e&&(e=e.children[0],t=m(e)),null!==t&&0<t.rows.length&&p.autoTable(t.columns,t.rows,{startY:r+20,styles:{fontSize:10,overflow:"linebreak"}}),t=null;t=0;for(e=D.length;t<e;t++)p.addPage(),
p.autoTable(D[t].table.columns,D[t].table.rows,{styles:{fontSize:10,overflow:"linebreak"}});p.save((x.SurveyTitle||"singleReport")+".pdf")});return v.promise};z.PrepForNewSurvey=function(){F=[];D=[]};return z}]).controller("ReportingQuestionController",["$scope","ReportingQuestionLogic","ReportingQuestionConstants","ReportingQuestionInterface",function(t,x,m,z){function F(){E=t.$watch("rQC.ChartType",function(e,m){e!==m&&(a.CommentList=[],a.GoogleChartsObjectList=[],D())})}function D(){var e=x.FormatDataForCorrectReportType(a.Question,
a.ChartType,a.DataFormat,a.TimeInterval),m=!1,p;for(p in e.GoogleChartsObjectList){for(var r in e.GoogleChartsObjectList[p].data.rows)if(e.GoogleChartsObjectList[p].data.rows[r].c[1]&&0<e.GoogleChartsObjectList[p].data.rows[r].c[1].v){m=!0;a.GoogleChartsObjectList.push(e.GoogleChartsObjectList[p]);break}if(!1===m)a:for(r in e.GoogleChartsObjectList[p].data.rows)if(e.GoogleChartsObjectList[p].data.rows[r].c)for(var v=1,w=e.GoogleChartsObjectList[p].data.rows[r].c.length;v<w;v+=2)if("0.0"<e.GoogleChartsObjectList[p].data.rows[r].c[v].v){m=
!0;a.GoogleChartsObjectList.push(e.GoogleChartsObjectList[p]);break a}}!1===m&&0<e.CommentList.length&&(a.ContainsOnlyComments=!0,a.ShowComments=!0,(m=localStorage.getItem("ReportingSettings_CollapseComments"))&&"true"===JSON.parse(m)&&(a.Show=!1),setTimeout(function(){z.RegisterCommentOnlyQuestion(a.Question.QuestionID);t.$apply()},1));a.CommentList=e.CommentList}var v={Totals:1,History:2},r={Frequency:4,Percent:8},w,H;w=localStorage.getItem("ReportingSettings_DataFormat");H=localStorage.getItem("ReportingSettings_DataType");
w=w?v[w]:v.Totals;H=H?r[H]:r.Frequency;var a=this;a.Question=t.passedQuestion;a.ChartType="ColumnChart";switch(w|H){case v.Totals|r.Frequency:a.DataFormat="Totals";break;case v.Totals|r.Percent:a.DataFormat="TotalsPercent";break;case v.History|r.Frequency:a.DataFormat="History";break;case v.History|r.Percent:a.DataFormat="HistoryPercent";break;default:a.DataFormat="Totals"}a.TimeInterval=null;a.TimeIntervals=[];a.CommentList=[];a.ShowComments=!1;a.Show=!0;a.GoogleChartsObjectList=[];a.ContainsOnlyComments=
!1;a.ChangeChartType=function(e){if(-1<m.ChartTypeEnum[e]&&3>=m.ChartTypeEnum[e])if(a.ChartType===e)if("PieChart"===a.ChartType)for(var p in a.GoogleChartsObjectList){var r=0,t=e=0,v=null;if(!a.GoogleChartsObjectList[p].options.slices){var v={},w;for(w in a.GoogleChartsObjectList[p].data.rows)if(a.GoogleChartsObjectList[p].data.rows[w].c[1]){var x=a.GoogleChartsObjectList[p].data.rows[w].c[1].v,t=t+x;x>e&&(e=x);x<r&&(r=x)}if(0<t)for(var z in a.GoogleChartsObjectList[p].data.rows)a.GoogleChartsObjectList[p].data.rows[z].c[1]&&
(v[z]={offset:.5-(a.GoogleChartsObjectList[p].data.rows[z].c[1].v-r)/e*.5})}a.GoogleChartsObjectList[p].options.slices=v}else if("ColumnChart"===a.ChartType&&"HistoryPercent"!==a.DataFormat)for(t in a.GoogleChartsObjectList)a.GoogleChartsObjectList[t].options.isStacked=!a.GoogleChartsObjectList[t].options.isStacked;else{if("LineChart"===a.ChartType)for(r in a.GoogleChartsObjectList)p=null,a.GoogleChartsObjectList[r].options.curveType||(p="function"),a.GoogleChartsObjectList[r].options.curveType=p}else a.ChartType=
e};a.ChangeDataFormat=function(e){E();"History"===e?"PieChart"===a.ChartType&&(a.ChartType="ColumnChart"):"Totals"===e&&("LineChart"===a.ChartType?a.ChartType="ColumnChart":"PieChart"===a.ChartType&&(a.ChartType="ColumnChart"));F();e===a.DataFormat&&("History"===e?e="HistoryPercent":"HistoryPercent"===e?e="History":"Totals"===e?e="TotalsPercent":"TotalsPercent"===e&&(e="Totals"));a.DataFormat=e};a.DisplayComments=function(e){a.ShowComments=x.DisplayComments(e)};a.DrawImage=function(e){z.RegisterImage(a.Question.DisplayOrder,
a.Question.QuestionID,e.visualization.getImageURI())};a.RenderSingleReport=function(){z.RenderSingleReport(a.Question.QuestionID)};v=localStorage.getItem("ReportingSettings_DateRangeType")||"Week";a.TimeInterval=v&&m.TimeIntervalEnum[v]?v:"Week";for(var p in m.TimeIntervalEnum)a.TimeIntervals.push({string:p,value:m.TimeIntervalEnum[p]});var E=null;F();(function(){t.$watch("rQC.DataFormat",function(e,m){e!==m&&(a.CommentList=[],a.GoogleChartsObjectList=[],D())})})();(function(){t.$watch("rQC.TimeInterval",
function(e,m){e!==m&&(a.CommentList=[],a.GoogleChartsObjectList=[],D())})})();D();return a}])})();
