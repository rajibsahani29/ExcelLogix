(function(){angular.module("iAspireApp").controller("AppController",["$scope","$http","DataService","ProjectConstants","SMAAlertFactory","$location",function(n,p,f,c,h,e){function d(){localStorage.clear();sessionStorage.clear();a.isUserAuthorized=!1;a.ActiveUser=null;a.UserID=null;a.AccessID=null;a.UserRoles=[];a.Merchant=null}var a=this;a.ActivePageName="Home";a.ShowHeader=!1;a.ShowFooter=!1;a.AppVersion=c.App.Version;a.LegalInformation=c.App.LegalText;a.isUserAuthorized=!1;a.rememberUser=!0;a.ActiveUser=
null;a.UserID=null;a.AccessID=null;a.UserRoles=[];a.Merchant=null;a.IsTeacher=!1;a.IsTrialVersion=!0;a.userLogin="";a.userPassword="";n.$watch("AppC.ActiveUser",function(b,g){if("undefined"!==typeof b&&b!==g)if(b.UserID){var k=localStorage.getItem("ReportingSettings_DateRangeValue"),l=localStorage.getItem("ReportingSettings_DateRangeType"),m=localStorage.getItem("ReportingSettings_CollapseComments"),c=localStorage.getItem("ReportingSettings_DataFormat"),d=localStorage.getItem("ReportingSettings_DataType");
localStorage.getItem("AccessID");localStorage.clear();sessionStorage.clear();!0===a.rememberUser&&(localStorage.setItem("AccessID",JSON.stringify(b.SessionID)),k&&l&&(localStorage.setItem("ReportingSettings_DateRangeValue",k),localStorage.setItem("ReportingSettings_DateRangeType",l)),m&&localStorage.setItem("ReportingSettings_CollapseComments",m),c&&localStorage.setItem("ReportingSettings_DataFormat",c),d&&localStorage.setItem("ReportingSettings_DataType",d));a.UserID=b.UserID;a.AccessID=b.SessionID;
a.isUserAuthorized=!0;switch(e.path()){case "/login":case "/createAccount":case "/forgotPassword":e.path("selection")}f.getMerchantsForUser().success(function(b,c,d,g){a.Merchant=b;a.IsTrialVersion=b.IsTrialAccount}).error(function(a,b,c,d){});f.userTeacherCheckIfUserIsTeacher().success(function(b,c,d,g){204!==c&&(a.IsTeacher=!0)}).error(function(a,b,c,d){})}else{localStorage.removeItem("AccessID");sessionStorage.clear();a.isUserAuthorized=!1;switch(e.path()){case "/login":case "/createAccount":case "/forgotPassword":return;
default:e.path("login")}h.CreateInfoAlert("You have been logged out!","Please log in again.")}},!0);(function(){p.defaults.headers.common["X-iA-AccessID"]=function(){return a.AccessID}})();(function(){var b=localStorage.getItem("AccessID");null!==b?(b=JSON.parse(b),a.AccessID=b,f.validateAccessID(b).success(function(b,c,d,e){a.ActiveUser=b}).error(function(a,b,c,e){403===b&&h.CreateInfoAlert(a,"Please contact iAspire for more details");d();window.location.hash="#/login"})):(d(),window.location.hash=
"#/login")})();return a}])})();
